<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Redirecting...</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
</head>
<body>
  <script>
    // 自定义域名下没有多余 path 段，例如 https://map.v2.avantek.ca/123
    var PATH_SEGMENTS_TO_SKIP = 0;

    // 你的 issues 仓库，用来当作“数据库”
    // 注意最后必须有斜杠 /
    var GITHUB_ISSUES_LINK = "https://api.github.com/repos/Leo7466/van-url/issues/";

    function getIssueNumberFromPath() {
      var pathSegments = window.location.pathname.split("/").filter(Boolean);
      // 跳过前面的路径段（自定义域名为 0）
      var index = PATH_SEGMENTS_TO_SKIP;
      if (index >= pathSegments.length) {
        return null;
      }
      return pathSegments[index];
    }

    function redirect() {
      var issueNumber = getIssueNumberFromPath();
      if (!issueNumber) {
        document.body.innerText = "No short URL id found in path.";
        return;
      }

      var xhr = new XMLHttpRequest();
      xhr.open("GET", GITHUB_ISSUES_LINK + issueNumber, true);
      xhr.onreadystatechange = function () {
        if (xhr.readyState === 4) {
          if (xhr.status === 200) {
            try {
              var issue = JSON.parse(xhr.responseText);
              var target = issue.title;
              if (target && /^https?:\/\//i.test(target)) {
                window.location.href = target;
              } else {
                document.body.innerText = "Issue title is not a valid URL.";
              }
            } catch (e) {
              document.body.innerText = "Failed to parse issue data.";
            }
          } else {
            document.body.innerText = "Short URL not found (" + xhr.status + ").";
          }
        }
      };
      xhr.send();
    }

    redirect();
  </script>
</body>
</html>
